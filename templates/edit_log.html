<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Log</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }
        .neon {
            color: #38bdf8;
        }
        .btn-glow {
            background-color: #2563eb;
            color: white;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            transition: 0.3s;
        }
        .btn-glow:hover {
            background-color: #1d4ed8;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl neon font-bold mb-8 text-center">Edit Communication Log</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="mb-6 p-4 {% if category == 'error' %}bg-red-500{% else %}bg-green-500{% endif %} text-white rounded-lg">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="glass p-8 rounded-lg">
            <form method="POST" action="{{ url_for('edit_log', log_id=log.id) }}">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Left Column -->
                    <div class="space-y-4">
                        <div>
                            <label for="person_type" class="block mb-2 text-lg">Category *</label>
                            <select id="person_type" name="person_type" class="w-full p-3 rounded bg-gray-700" required>
                                <option value="Client" {% if log.person_type == 'Client' %}selected{% endif %}>Client</option>
                                <option value="Colleague" {% if log.person_type == 'Colleague' %}selected{% endif %}>Colleague</option>
                                <option value="Supplier" {% if log.person_type == 'Supplier' %}selected{% endif %}>Supplier</option>
                                <option value="Partner" {% if log.person_type == 'Partner' %}selected{% endif %}>Partner</option>
                                <option value="Team Member" {% if log.person_type == 'Team Member' %}selected{% endif %}>Team Member</option>
                                <option value="Manager" {% if log.person_type == 'Manager' %}selected{% endif %}>Manager</option>
                                <option value="Customer" {% if log.person_type == 'Customer' %}selected{% endif %}>Customer</option>
                                <option value="Vendor" {% if log.person_type == 'Vendor' %}selected{% endif %}>Vendor</option>
                                <option value="Other" {% if log.person_type == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>

                        <div>
                            <label for="name" class="block mb-2 text-lg">Contact Name *</label>
                            <input type="text" id="name" name="name" value="{{ log.name }}"
                                   class="w-full p-3 rounded bg-gray-700"
                                   pattern=".{2,50}"
                                   title="2-50 characters"
                                   required>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-4">
                        <div>
                            <label for="interaction_type" class="block mb-2 text-lg">Communication Type *</label>
                            <select id="interaction_type" name="interaction_type" class="w-full p-3 rounded bg-gray-700" required>
                                <option value="Phone Call" {% if log.interaction_type == 'Phone Call' %}selected{% endif %}>Phone Call</option>
                                <option value="Email" {% if log.interaction_type == 'Email' %}selected{% endif %}>Email</option>
                                <option value="Video Meeting" {% if log.interaction_type == 'Video Meeting' %}selected{% endif %}>Video Meeting</option>
                                <option value="In-Person Meeting" {% if log.interaction_type == 'In-Person Meeting' %}selected{% endif %}>In-Person Meeting</option>
                                <option value="Text Message" {% if log.interaction_type == 'Text Message' %}selected{% endif %}>Text Message</option>
                                <option value="Instant Message" {% if log.interaction_type == 'Instant Message' %}selected{% endif %}>Instant Message</option>
                                <option value="Social Media" {% if log.interaction_type == 'Social Media' %}selected{% endif %}>Social Media</option>
                                <option value="Other" {% if log.interaction_type == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>

                        <div>
                            <label for="issue_type" class="block mb-2 text-lg">Purpose *</label>
                            <select id="issue_type" name="issue_type" class="w-full p-3 rounded bg-gray-700" required>
                                <option value="Follow-up" {% if log.issue_type == 'Follow-up' %}selected{% endif %}>Follow-up</option>
                                <option value="Project Update" {% if log.issue_type == 'Project Update' %}selected{% endif %}>Project Update</option>
                                <option value="Question" {% if log.issue_type == 'Question' %}selected{% endif %}>Question</option>
                                <option value="Problem Resolution" {% if log.issue_type == 'Problem Resolution' %}selected{% endif %}>Problem Resolution</option>
                                <option value="Planning" {% if log.issue_type == 'Planning' %}selected{% endif %}>Planning</option>
                                <option value="Feedback" {% if log.issue_type == 'Feedback' %}selected{% endif %}>Feedback</option>
                                <option value="Introduction" {% if log.issue_type == 'Introduction' %}selected{% endif %}>Introduction</option>
                                <option value="Networking" {% if log.issue_type == 'Networking' %}selected{% endif %}>Networking</option>
                                <option value="Sales" {% if log.issue_type == 'Sales' %}selected{% endif %}>Sales</option>
                                <option value="Support" {% if log.issue_type == 'Support' %}selected{% endif %}>Support</option>
                                <option value="Other" {% if log.issue_type == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="notes" class="block mb-2 text-lg">Notes *</label>
                    <textarea id="notes" name="notes"
                              class="w-full p-3 rounded bg-gray-700"
                              rows="5"
                              maxlength="500"
                              required>{{ log.notes }}</textarea>
                    <div class="flex justify-between mt-2">
                        <p class="text-sm text-gray-400">Max 500 characters</p>
                        <p class="text-sm text-gray-400"><span id="char-count">{{ 500 - log.notes|length }}</span> characters remaining</p>
                    </div>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="btn-glow px-8 py-3 text-lg">Update Log</button>
                    <a href="{{ url_for('index') }}" class="px-8 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">Cancel</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Character counter for notes
        function updateCharCount() {
            const textarea = document.getElementById('notes');
            const counter = document.getElementById('char-count');
            const remaining = 500 - textarea.value.length;
            counter.textContent = remaining;
            counter.style.color = remaining < 50 ? '#e74c3c' : '#7f8c8d';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const notes = document.getElementById('notes');
            notes.addEventListener('input', updateCharCount);
            updateCharCount(); // Initial update
        });
    </script>
</body>
</html>